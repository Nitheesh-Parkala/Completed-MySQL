SUB QUERY
=========
A QUERY INSIDE  ANOTHER QUERY IS KNOW AS SUB QUERY.
 WORKING PRINCIPLE OF SUB QUERY
==================================
1. SUB QUERY CONSITING OF INNER QUERY AND OUTER QUERY
2. ALWAYS INNER QUERY WILL EXCEUTE FIRST AND GENERATES THE OUT PUT.
3. THE OUTPUT OF INNER  QUERY WILL BE GIVEN AS INPUT TO THE OUTER QUERY.
4.THE OUTER QUERY COLLECTS THE INPUT AND EXCUTE COMPLETELY TO GENRATE THE FINAL RESULTS.
5. HERE THE OUTER QUERY DEPENDS UPON THE INNER QUERY.


=============================================
RULES TO WRITE SUB QUERY,

1. WHERE SAL>(SELECT FNAME - WRONG
          DECIMAL!= VARCHAR
   WHERE SAL> (SELECT COMM - RIGHT
            DECIMAL = DECIMAL

IN SUBQUERY , THE DATA TYPES MUST MATCH BETWEEN INNER QUERY AND OUTER QUERY

2. WHERE SAL=(SELECT SAL,COMM - WRONG
WHERE SAL=(SELECT SAL - RIGHT
IN, SUBQUERY, WE CAN PASS ONLY SINGLE COLUMN INSIDE THE INNER QUERY.

WHEN OR WHERE WE CAN GO FOR SUB QUERY
===============================================
 CASE1: WHENEVER WE COME ACROSS UNKNOWN VALUES , WE GO FOR SUB QUERY 
 CASE2: WHENEVER A DATA IS ONE TABLE AND CONDITION IS PASSED IN ANOTHER TABLE
 WE GO FOR SUB QUERY.

=============================================================================

115. WAQTD DEATILS OF EMP WHOSE SAL IS MORE THAN KIRANS SAL.
SELECT * FROM EMP 
WHERE SAL>(SELECT SAL 
FROM EMP 
WHERE FNAME='KIRAN');

116. WAQTD THE FANME ,LNAME SAL WHO R WORKING IN SAME JOB ROLE AS KARANS JOB ROLE.
SELECT FNAME,LNAME,SAL,JOB FROM EMP WHERE JOB=(SELECT JOB FROM EMP WHERE FNAME='KARAN');

117.WAQTD THE DEATILS OF EMP WHO R WORKING HAS SALESMAN AND GETTING SAL MORE THAN DHARANI.

SELECT * FROM EMP WHERE JOB='SALESMAN' AND SAL >(SELECT SAL FROM EMP 
WHERE FNAME='DHARANI');

118. WAQTD THE FNAME,SAL DNO IF THE EMP IS WORKING IN SAME DEPT AS MURALIS DEPT AND GETTING SAL MORE THAN FARIYA.

SELECT FNAME,SAL,DNO FROM EMP WHERE DNO=
(SELECT DNO FROM EMP WHERE FNAME='MURALI')AND SAL>
(SELECT  SAL FROM EMP WHERE FNAME='FARIYA');

119.WAQTD THE EMP FNAME ,SAL IF THE EMP IS GETTING SAL MORE THAT DHARANI AND LESS THAN SAMIR

SELECT FNAME,SAL FROM EMP WHERE SAL >
(SELECT SAL FROM EMP  WHERE FNAME='DHARANI') AND SAL<
(SELECT SAL FROM EMP  WHERE FNAME='SAMEER');

120.WAQTD THE DEATILS OF EMP WHO WAS HIRED AFTER 2 YEARS OF FIRST EMP OF THE COMPANY.

SELECT * FROM EMP WHERE DOJ>
(SELECT DATE_ADD(MIN(DOJ),INTERVAL 2 YEAR) FROM EMP;

121.WAQTD THE FNAME,DOB IF THE EMP IS 2 YEARS OR MORE YOUNGER THAN RAHUL.

SELECT FNAME,DOB FROM EMP WHERE DOB >
(SELECT DOB FROM EMP
WHERE FNAME='RAHUL');
OR 
SELECT FNAME, DOB 
FROM EMP 
WHERE DOB > DATE_SUB((SELECT DOB FROM EMP WHERE FNAME = 'RAHUL'), INTERVAL 2 YEAR);


122.WAQTD THE DEATILS OF EMP IF THE EMP IF THE EMP WAS HIREDD 2 YEARS BEFORE KIRAN DOJ

SELECT * FROM EMP WHERE DOJ<
(SELECT DATE_SUB(DOJ, INTERVAL 2 YEAR) FROM EMP WHERE FNAME='KIRAN');

123.WAQTD THE DEPT NAME OF SIDDARTH.
SEELCT DNAME FROM DEPT WHERE DNO=
(SELECT DNO FROM EMP WHERE FNAME='SIDDARTH');


124. WAQTD THE DEATILS OF CUSTOMER WHO LIVES IN VIJAYANAGR.

SELECT * FROM CUSTOMER WHERE LID=
(SELECT LID FROM LOCATION WHERE LOCATION='VIJAYANAGAR');


125.WAQTD THE DEATILS OF EMP WHO WORKS IN MARKETING DEPT.

SELECT * FROM EMP WHERE DNO=(
SELECT DNO FROM DEPT WHERE DNAME='MARKETING');


126. WAQTD THE DEATILS OF EMP WHO WORKS IN MARKETING OR TECHNCAL DEPT.
SELECT * FROM EMP WHERE DNO IN(
SELECT  DNO FROM DEPT WHERE DNAME IN ('MARKETING','TECHNICAL')); 

TYPES OF SUB QUERY
=================

SINGLE ROW SUB QUERY: WHEN THE INNER QUERY RETURNS ONE ROW , THEN IT IS KNOW AS SINGLE ROW SUB QUERY.
> WE CAN USE NORMAL OPERATORS(=,!=,>=,<=,>,<) OR SEPICAL OPERTORS (IN ,NOT,IN,ALL,ANY)

MUTLI ROW SUB QUERY: WHEN THE INNER QUERY RETURNS MORE THAN ONE ROW , 
THEN IT IS KNOW AS MUTI ROW SUB QUERY.
WE CAN ONLY USE SPECIAL OPERTORS(IN,NOT,NOT IN,ALL,ANY)

127.WAQTD THE DEATILS OF EMP WHO R GETTING SAL MORE THAN PRIYA AND WORKIG IN DEPT AS A TECHINCAL.

SELECT * FROM EMP WHERE SAL >
(SELECT  SAL FROM EMP WHERE FNAME='PRIYA') AND DNO IN
(SELECT DNO FROM DEPT WHERE DName='TECHNICAL');

128.WAQTD THE DEPT NAME OF THE EMP WHO R WORKING IN SAME JOB ROLES AS AMAN JOBS  ROLE

SELECT DNAME  FROM DEPT  WHERE DNO IN
(SELECT DNO FROM EMP WHERE JOB IN (
SELECT JOB FROM EMP WHERE FNAME= 'AMAN'));

129. WAQTD THE DEATILS OF EMP WHO R WORKING IN TECHNICAL DEPT.

SELECT * FROM EMP WHERE DNO IN
(SELECT DNO FROM DEPT WHERE DNAME='TECHNICAL');

=================================================
ALTER TABLE ORDERS 
ADD CID INT;

UPDATE ORDERS SET CID=505 WHERE ORDER_ID=1111;
UPDATE ORDERS SET CID=507 WHERE ORDER_ID=1127;
UPDATE ORDERS SET CID=501 WHERE ORDER_ID=1201;
UPDATE ORDERS SET CID=511 WHERE ORDER_ID=1773;

130.WAQTD THE CUSTOMER FNAME,LNAME IF THE CUSTOMER LIVES IN MUMBAI CITY.

SELECT  FIRST_NAME,LAST_NAME FROM CUSTOMER WHERE LID IN
(SELECT LID FROM LOCATION WHERE CITY='MUMBAI');

131.WAQTD THE CUSTOMER NAME WHO HAS ORDERD ANY PRODUCT.

SELECT FIRST_NAME,LAST_NAME FROM CUSTOMER WHERE CID IN
(SELECT CID FROM ORDERS);

132.WAQTD THE WORKING LOCATION OF MARKETING DEPT.

SELECT LOCATION FROM LOCATION WHERE LID IN
(SELECT LID FROM DEPT WHERE DNAME='MARKETING');

133. WAQTD THE WORKING LOCATION OF KIRAN.
SELECT LOCATION FROM LOCATION WHERE LID IN
( SELECT LID FROM DEPT WHERE DNO IN
(SELECT DNO FROM EMP WHERE FNAME='KIRAN'));

134.WAQTD THE CUSTOMER FNAME WHO AS ORDERD THE WALLET(PNAME).

SELECT FIRST_NAME FROM CUSTOMER WHERE PRODUCT_ID IN
(SELECT CID FROM ORDERS WHERE PRODUCT_ID IN
(SELECT PRODUCT_ID FROM PRODUCT WHERE P_NAME='WALLET'));


135.WAQTD THE DEATILS OF EMP WHO HAS DELIVERED THE PRODUCT.

SELECT * FROM EMP WHERE EID IN(
SELECT EID FROM ORDERS);

136.WAQTD THE DEATILS OF EMP WHO HAS DELIVERD THE PRODUCT TO MUMBAI CITY.

SELECT * FROM EMP WHERE EID IN
(SELECT EID FROM ORDERS WHERE CID IN
(SELECT CID FROM  CUSTOMER WHERE LID IN
(SELECT LID FROM LOCATION WHERE CITY='MUMBAI')));

137.WAQTD THE LOCATION CITY AND STATE FROM WHERE THE WALLET AS BEEN DELIVERD.

SELECT LOCATION,CITY,STATE FROM LOCATION WHERE LID IN
(SELECT LID FROM CUSTOMER WHERE CID IN
(SELECT CID FROM ORDERS WHERE PRODUCT_ID  IN
(SELECT PRODUCT_ID FROM PRODUCT WHERE P_NAME='WALLET')));

138.WAQTD THE DEATILS OF EMP WHO R WORKING IN MYSORE.


SELECT * FROM EMP WHERE DNO IN
(SELECT  DNO FROM DEPT WHERE LID IN
(SELECT LID FROM LOCATION WHERE CITY='MYSORE'));

139.WAQTD THE NUMBER OF EMPS WORKIG IN VIJAYNAGAR.

SELECT COUNT(*) FROM EMP WHERE DNO IN(
SELECT DNO FROM DEPT WHERE LID IN(
SELECT LID FROM LOCATION WHERE LOCATION='VIJAYANAGAR'));

140.WAQTD THE DEATILS OF EMP WHO R GETTING 5TH MAX SAL.

SELECT * FROM EMP WHERE SAL=
(SELECT DISTINCT SAL
FROM EMP  ORDER BY SAL DESC
LIMIT 1 OFFSET 4);

141. WAQTD THE DEATILS OF EMP WHO ARE GETTING TOP 5 SAL.

SELECT * FROM EMP WHERE SAL IN(
SELECT SAL FROM 
(SELECT DISTINCT SAL FROM EMP  ORDER BY SAL DESC LIMIT 5) RES_TABLE);


142.WAQTD THE DEATILS OF EMP WHO R GETTING TOP 3 MIN SAL

SELECT * FROM EMP WHERE SAL IN(
SELECT * FROM
(SELECT DISTINCT SAL FROM EMP ORDER BY SAL ASC LIMIT 3) RES_TABLE);


=====================================================================
RANK() AND DENSE_RANK():
===========================

SELECT FNAME,SAL,DENSE_RANK() OVER (ORDER BY SAL DESC) FROM EMP;


143.WAQTD THE DEATILS OF EMP WHO R GETTING SAL MORE THAN KIRAN.

SELECT * FROM EMP WHERE SAL>(
SELECT SAL FROM  EMP WHERE FNAME='KIRAN' );

144.WAQTD THE DEATILS OF EMP WHO R GETTING SAL MORE THAN ALL  THE SALESMAN.

SELECT * FROM EMP WHERE SAL >(
SELECT MAX(SAL) FROM EMP WHERE JOB='SALESMAN');

OR
SELECT * FROM EMP WHERE SAL > ALL(
SELECT SAL FROM EMP WHERE JOB='SALESMAN');

ALL/ANY
------
THESE ARE THE MULTIVALUED OPERATOR WHICH TAKES SINGLE VALUE AT LHS AND MULTIPLE VALUES AT RHS.
SYNTAX: COLUMN_NAME>/< ALL/ANY (SELECT multi_row_subquery)


145. WAQTD THE DEATILS OF EMP WHO R GETTING SAL MORE THAN ANY ONE OF THE DISPACHER.

SELECT * FROM EMP WHERE SAL >ANY(
SELECT SAL FROM EMP WHERE JOB='DISPATCHER');

146.WAQTD THE DEATILS OF EMP WHO R ALSO THE CUSTOMER BUT NOT ORDERD ANY PRODUCT.

SELECT * FROM EMP WHERE CID NOT IN(
SELECT CID FROM ORDERS);

147.WAQTD THE EMP FNAME,LNAME IF THE EMP IS GETTING SAL MORE THAN AVG SAL OF THE DEPT NUMBER 111.

SELECT FNAME,LNAME,SAL FROM  EMP WHERE SAL>
(SELECT AVG(SAL) FROM EMP WHERE DNO=111);

148.WQATD THE CUSTOMER NAME WHO AS ORDERD THE PRODUCT FROM VIJAYANAGAR.

SELECT CID FROM CUSTOMER WHERE LID IN
(SELECT LID FROM LOCATION WHERE LOCATION='VIJAYANAGAR') AND
CID IN (SELECT CID FROM ORDERS);

149. wqtd the details of kirans manager
 select * from emp where eid in(select mgr from emp where fname='kiran');

150.wqtd fname,lname of fariya's manager.
 select fname,lname from emp where eid in(select mgr from emp where fname='fariya');

151.wqtd the dept name of karan's manager
 select dname from dept where dno in (select dno from emp where fname='karan');

152.wqtd the working location of aman's manager.
select loc from location where lid in(select lid from dept where dno in(select dno from emp where eid in(select mgr from emp where fname='aman')));

153.wqtd the full name of hema's manager
SELECT CONCAT(FNAME,'',LNAME) FULL_NAME FROM EMP WHERE  EID IN(SELECT MGR FROM EMP WHERE FNAME='HEMA');

154.wqtd the detail of emp who are not working in vijayanagar.
select * from emp where dno not in(select dno from dept where lid in(select lid from location where location='vijayanagar'));

155.wqtd the kiran's manager's manager.
select * from emp where eid in(select mgr from emp where eid in(select mgr from emp where fname='kiran'));

156.wqtd the details of emp who are reporting to sameer.
select * from emp where mgr in(select eid from emp where fname='sameer'); 

157.wqtd the dept name of emp who are reporting to siddarth
 select dname from dept where dno in(select dno from emp where eid in(select eid from emp where fname='siddarth'));

157.wqtd the details of emp who are reporting to kiran's manager
select * from emp where mgr in (select mgr from emp where fname='kiran');

159.wqtd the details of emp who are not working as reporting managers.
select * from emp where mrg not in> all (select distinct mgr from emp);

 select * from emp where eid not in(select distinct mgr from emp where mgr is not null);

160.wqtd the deatails of manager who has atleast 4 reporting
select * from emp where eid in(select mgr from emp group by mgr having count(*)>=4);

161.wqtd the dept name of emps if the emp is having reporting between 1 and 4.(if you have null values remove it)
 select dname from dept where dno in(select dno from emp where eid in(select mgr from emp group by mgr having count(*) between 1 and 4));

162.wqtd the details of emp if the emp is getting salary more than avg sal of dno 111.
select * from emp where sal>(select avg(sal) from emp where dno=111);

CO-RELATED SUBQUERY
====================
HERE,NOT ONLY THE OUTER QUERY DEPENDS UPON THE INNER QUERY,BUT ALSO INNER QUERY DEPNDS UPON THE UPON THE OIUTER QUERY.

163.WAQTD THE DEATILS OF EMP IF THE EMP IS GETTING SAL MORE THAN AVG SAL OF HIS DEPT.

SELECT * FROM EMP E1 WHERE SAL> (SELECT AVG(SAL) FROM EMP WHERE DNO=E1.DNO);

164.WAQTD THE DEATILS OF EMP WHO R ELDER THAN THEIR REPORTING MANAGER.

SELECT * FROM EMP E1 WHERE DOB < (SELECT DOB FROM EMP WHERE EID=E1.MGR);


165.WAQTD THE DEATILS OF EMP IF THE EMP GENDER AND HIS/HER MANAGER GENDER IS SAME.

SELECT * FROM EMP E1 WHERE GENDER=(SELECT GENDER FROM EMP WHERE EID=E1.MGR);


DRAWBACKS OF SUBQUERY
=====================
1) WE CANNOT ABLE TO GET THE DATA FROM THE MULTIPLE TABLES AT A TIME.
2) TO CONNECT MULTIPLE TABLES,MANY INNER QUERIES MUST BE INVOLED.
3) CO-RELATED SUB QUERY IS TOUGHER TO SLOVE WHEN COMPARED TO JOINS.


 

